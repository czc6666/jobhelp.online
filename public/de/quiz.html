<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test starten | Karriere-Kompass</title>
    <meta name="description" content="Beantworten Sie 5 Fragen, um sofort einen KI-generierten, tiefgehenden Analysebericht Ihrer beruflichen Persönlichkeit zu erhalten und Ihre Karriere-Entdeckungsreise zu beginnen.">
    <meta name="keywords" content="Karrieretest, Persönlichkeitsanalyse, KI-Karriereberater, berufliche Richtung, Karriere-Kompass, Online-Quiz">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://jobhelp.online/de/quiz.html">

    <!-- Hreflang for SEO -->
    <link rel="alternate" hreflang="zh" href="https://jobhelp.online/quiz.html">
    <link rel="alternate" hreflang="en" href="https://jobhelp.online/en/quiz.html">
    <link rel="alternate" hreflang="es" href="https://jobhelp.online/es/quiz.html">
    <link rel="alternate" hreflang="de" href="https://jobhelp.online/de/quiz.html">
    <link rel="alternate" hreflang="x-default" href="https://jobhelp.online/quiz.html">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://jobhelp.online/de/quiz.html">
    <meta property="og:title" content="Test starten | Karriere-Kompass">
    <meta property="og:description" content="Beantworten Sie 5 Fragen und erhalten Sie sofort einen KI-generierten, tiefgehenden Analysebericht.">
    <meta property="og:image" content="https://jobhelp.online/og-image.png">
    <meta property="og:site_name" content="Karriere-Kompass">
    <meta property="og:locale" content="de_DE">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://jobhelp.online/de/quiz.html">
    <meta name="twitter:title" content="Test starten | Karriere-Kompass">
    <meta name="twitter:description" content="Beantworten Sie 5 Fragen und erhalten Sie sofort einen KI-generierten, tiefgehenden Analysebericht.">
    <meta name="twitter:image" content="https://jobhelp.online/og-image.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"></script>
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js?onload=onTurnstileLoad" async defer></script>
    <style> .quiz-card, #direct-input-container { min-height: 32rem; } </style>
</head>
<body class="bg-gray-50 flex flex-col min-h-screen">

    <!-- Header -->
    <header class="w-full bg-white/80 backdrop-blur-md sticky top-0 z-10 border-b border-gray-200">
        <div class="container mx-auto px-6 py-4 flex items-center justify-between">
            <a href="/de/" class="text-xl font-bold text-gray-900">Karriere-Kompass</a>
            <a href="/de/" class="text-sm font-semibold text-gray-600 hover:text-blue-600">
                &larr; Zurück zur Startseite
            </a>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow flex flex-col items-center justify-center p-4">
        <div id="view-container" class="w-full max-w-2xl mx-auto">
            <!-- Quiz Container -->
            <div id="quiz-container"></div>
            <!-- Direct Input -->
            <div id="direct-input-container" class="hidden bg-white rounded-xl shadow-lg p-6 md:p-10">
                <h2 class="text-2xl md:text-3xl font-bold text-gray-900 mb-2">Direkt mit dem KI-Mentor sprechen</h2>
                <p class="text-gray-600 mb-6">Geben Sie unten Ihre Bedenken, Gedanken oder eine kurze Vorstellung ein, und die KI erstellt einen persönlichen Karriereplan für Sie.</p>
                <textarea id="direct-input-text" rows="8" placeholder="z.B.: Ich studiere Marketing, fühle mich aber introvertiert und mag keinen Smalltalk. Ich bin unsicher über meine Zukunft..." class="w-full border rounded-lg p-3 text-base focus:ring-2 focus:ring-blue-500 focus:outline-none"></textarea>
                <button id="direct-input-submit-btn" class="w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-full text-base inline-block hover:bg-blue-700 transition mt-6">
                    Analyse von KI anfordern
                </button>
            </div>
        </div>

        <!-- Skip Link -->
        <div id="skip-quiz-container" class="text-center mt-6">
            <button id="skip-quiz-btn" class="text-sm font-semibold text-gray-500 hover:text-blue-600 transition">
                Keine Fragen beantworten? Geben Sie Ihre Gedanken direkt ein &rarr;
            </button>
        </div>

        <!-- Results/Chat -->
        <div id="results-container" class="w-full max-w-3xl mx-auto hidden">
            <div id="initial-result" class="text-center bg-white rounded-xl shadow-lg p-6 md:p-10"></div>
            <div id="chat-wrapper" class="hidden mt-6 bg-white rounded-xl shadow-lg p-6 md:p-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-4">Tiefgehendes Gespräch mit dem KI-Mentor</h2>
                <div id="chat-history" class="h-[50vh] overflow-y-auto pr-4 mb-4 border-b"></div>
                <div id="chat-input-container" class="flex items-center pt-4">
                    <input type="text" id="chat-input" placeholder="Weitere Fragen? Hier eingeben..." class="flex-grow border rounded-l-lg p-3 focus:ring-2 focus:ring-blue-500 focus:outline-none">
                    <button id="send-btn" class="bg-blue-600 text-white font-semibold px-6 py-3 rounded-r-lg hover:bg-blue-700 transition">&rarr;</button>
                </div>
            </div>
        </div>
    </main>

    <div id="turnstile-container"></div>
    <footer class="w-full py-6 text-center bg-white/50 border-t">
        <p class="text-sm text-gray-500">&copy; 2025 Karriere-Kompass. Alle Rechte vorbehalten.</p>
    </footer>

    <script>
        const API_URL = "/api/analyze";
        const LANG = "de";
        let turnstileWidgetId = null;
        let actionQueue = [];
        let isVerificationInProgress = false;

        window.onTurnstileLoad = function () {
            if (typeof turnstile !== 'undefined') {
                turnstileWidgetId = turnstile.render('#turnstile-container', {
                    sitekey: '0x4AAAAAABhyfTjwR6RXipd_', 
                    callback: function(token) {
                        isVerificationInProgress = false;
                        const action = actionQueue.shift();
                        if (action) { action(token); }
                    },
                    'expired-callback': function() {
                        isVerificationInProgress = false;
                        if (turnstileWidgetId) { turnstile.reset(turnstileWidgetId); }
                    },
                    'error-callback': function() {
                        isVerificationInProgress = false;
                        console.error('Turnstile verification failed.');
                        alert('Die Sicherheitsüberprüfung ist fehlgeschlagen. Bitte laden Sie die Seite neu und versuchen Sie es erneut.');
                    },
                    size: 'invisible'
                });
            }
        };

        function withTurnstileVerification(action) {
            if (isVerificationInProgress) { return; }
            actionQueue.push(action);
            isVerificationInProgress = true;
            if (turnstileWidgetId) { turnstile.execute(turnstileWidgetId); }
        }

        const questions = [
            {
                question: "Stellen Sie sich vor, Sie sind auf einer lockeren Party. Welche Aktivität würde Sie am meisten ansprechen?",
                options: [
                    "Ein tiefes, persönliches Gespräch mit einem engen Freund führen.",
                    "Leute beobachten und die sozialen Dynamiken analysieren.",
                    "An einem lebhaften Brettspiel oder einer Gruppenaktivität teilnehmen.",
                    "Dem Gastgeber beim Organisieren von Essen helfen oder sicherstellen, dass alle eine gute Zeit haben."
                ]
            },
            {
                question: "Wenn Sie ein komplett freies Wochenende hätten, wie würden Sie es idealerweise verbringen?",
                options: [
                    "Ein Buch lesen, eine neue Fähigkeit erlernen oder eine Dokumentation ansehen.",
                    "Etwas Kreatives schaffen: schreiben, zeichnen, Musik machen oder ein DIY-Projekt.",
                    "Wandern gehen, Sport treiben oder eine andere körperliche Aktivität im Freien.",
                    "Qualitätszeit mit Familie oder Freunden verbringen."
                ]
            },
            {
                question: "Wenn Sie bei der Arbeit vor einem komplexen Problem stehen, was ist Ihr erster Ansatz?",
                options: [
                    "Daten sammeln und analysieren, um die Ursache zu verstehen.",
                    "Kreative und unkonventionelle Lösungen brainstormen.",
                    "Ein Team organisieren und Aufgaben delegieren, um es von mehreren Seiten anzugehen.",
                    "Die Auswirkungen des Problems auf Teammitglieder und Kunden berücksichtigen."
                ]
            },
            {
                question: "Was motiviert Sie in einer Karriere am meisten?",
                options: [
                    "Die Beherrschung einer Fähigkeit und zum Experten auf Ihrem Gebiet zu werden.",
                    "Die Möglichkeit, Kreativität auszudrücken und innovativ zu sein.",
                    "Führung, Einfluss und das Erreichen ehrgeiziger Ziele.",
                    "Anderen zu helfen und einen positiven Einfluss auf die Gesellschaft zu haben."
                ]
            },
            {
                question: "Welche Art von Arbeitsumgebung bevorzugen Sie?",
                options: [
                    "Eine ruhige, strukturierte Umgebung, in der Sie sich auf Ihre Aufgaben konzentrieren können.",
                    "Eine dynamische, flexible Umgebung, die zum Experimentieren anregt.",
                    "Eine wettbewerbsorientierte, ergebnisorientierte Umgebung mit klaren Zielen.",
                    "Eine kollaborative, unterstützende Umgebung, die auf Teamarbeit ausgerichtet ist."
                ]
            }
        ];

        let currentQuestionIndex = 0;
        const userAnswers = [];
        const converter = new showdown.Converter({
            simplifiedAutoLink: true,
            strikethrough: true,
            tables: true
        });

        document.addEventListener("DOMContentLoaded", () => {
            renderQuestion(currentQuestionIndex);
            document.getElementById('skip-quiz-btn').addEventListener('click', showDirectInput);
            document.getElementById('direct-input-submit-btn').addEventListener('click', handleDirectInputSubmit);
        });

        function renderQuestion(index) {
            const quizContainer = document.getElementById('quiz-container');
            const questionData = questions[index];
            const card = document.createElement('div');
            card.className = 'quiz-card bg-white rounded-xl shadow-lg p-6 md:p-10 card-enter';
            card.innerHTML = `
                <div class="text-right text-sm text-gray-500 mb-4">Frage ${index + 1} / ${questions.length}</div>
                <h2 class="text-2xl md:text-3xl font-bold text-gray-900 mb-6">${questionData.question}</h2>
                <div class="space-y-4">
                    ${questionData.options.map((option, i) => `
                        <button data-answer="${i}" class="w-full text-left bg-gray-100 hover:bg-blue-100 border border-gray-200 text-gray-800 font-semibold py-3 px-5 rounded-lg transition">
                            ${option}
                        </button>
                    `).join('')}
                </div>`;

            quizContainer.innerHTML = ''; // Clear previous card
            quizContainer.appendChild(card);

            // Add event listeners to new buttons
            card.querySelectorAll('button[data-answer]').forEach(button => {
                button.addEventListener('click', handleAnswer);
            });
            
            // Trigger animation
            setTimeout(() => card.classList.remove('card-enter'), 10);
        }

        function handleAnswer(event) {
            userAnswers.push(event.target.innerText);
            const card = document.querySelector('.quiz-card');
            
            card.classList.add('card-exit');
            card.addEventListener('transitionend', () => {
                currentQuestionIndex++;
                if (currentQuestionIndex < questions.length) {
                    renderQuestion(currentQuestionIndex);
                } else {
                    startAnalysis(userAnswers);
                }
            }, { once: true });
        }

        function showDirectInput() {
            document.getElementById('quiz-container').classList.add('hidden');
            document.getElementById('skip-quiz-container').classList.add('hidden');
            const directInputContainer = document.getElementById('direct-input-container');
            directInputContainer.classList.remove('hidden');
        }

        function handleDirectInputSubmit() {
            const text = document.getElementById('direct-input-text').value.trim();
            if (text.length < 20) {
                alert("Für eine aussagekräftigere Analyse beschreiben Sie bitte Ihre Situation ausführlicher (mindestens 20 Zeichen).");
                return;
            }
            startAnalysis(text);
        }

        function startAnalysis(data) {
            // Hide quiz/input view and show results container
            document.getElementById('view-container').classList.add('hidden');
            document.getElementById('skip-quiz-container').classList.add('hidden');
            const resultsContainer = document.getElementById('results-container');
            resultsContainer.classList.remove('hidden');

            const initialResultDiv = document.getElementById('initial-result');
            initialResultDiv.innerHTML = `
                <div class="spinner mx-auto mb-4"></div>
                <h2 class="text-2xl font-bold text-gray-800">Ihr KI-Mentor denkt nach...</h2>
                <p class="text-gray-600 mt-2">Ihre Antworten werden analysiert und Ihr beruflicher Persönlichkeitsbericht wird erstellt. Dies kann etwa 15 Sekunden dauern.</p>`;
            
            withTurnstileVerification((token) => {
                fetchAnalysis(data, token, true);
            });
        }
        
        let fullReport = "";

        function fetchAnalysis(data, token, isInitialAnalysis) {
            const prompt = isInitialAnalysis ? 
                (Array.isArray(data) ? `Hier sind meine Antworten auf das Quiz: ${data.join(', ')}` : data) :
                `Bisheriger Gesprächskontext: "${fullReport}"\n\nMeine neue Frage: "${data}"`;

            let accumulatedContent = "";
            
            fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ prompt, lang: LANG, turnstileToken: token })
            })
            .then(response => {
                if (!response.body) throw new Error('ReadableStream not available.');
                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                
                const targetDiv = isInitialAnalysis ? document.getElementById('initial-result') : null;
                const chatHistoryDiv = isInitialAnalysis ? null : document.getElementById('chat-history');
                let aiMessageContainer;

                if (chatHistoryDiv) {
                    aiMessageContainer = document.createElement('div');
                    aiMessageContainer.className = 'mb-4';
                    aiMessageContainer.innerHTML = '<div class="font-bold text-gray-800 mb-1">KI-Mentor</div><div class="bg-gray-100 p-3 rounded-lg"></div>';
                    chatHistoryDiv.appendChild(aiMessageContainer);
                }

                function push() {
                    reader.read().then(({ done, value }) => {
                        if (done) {
                            if (isInitialAnalysis) {
                                fullReport = accumulatedContent; // Store the full initial report
                                showChatInterface();
                            } else {
                                fullReport += `\n\nBenutzerfrage: ${data}\nKI-Antwort: ${accumulatedContent}`; // Append follow-up to context
                            }
                            enableChatInput();
                            return;
                        }
                        accumulatedContent += decoder.decode(value, { stream: true });
                        const htmlContent = converter.makeHtml(accumulatedContent);
                        
                        if (targetDiv) {
                            targetDiv.innerHTML = htmlContent;
                        } else if (aiMessageContainer) {
                            aiMessageContainer.querySelector('.bg-gray-100').innerHTML = htmlContent;
                            chatHistoryDiv.scrollTop = chatHistoryDiv.scrollHeight;
                        }

                        push();
                    }).catch(error => {
                        console.error('Streaming error:', error);
                        const errorMsg = "<p class='text-red-500'>Entschuldigung, bei der Kommunikation mit der KI ist ein Fehler aufgetreten. Bitte versuchen Sie es später erneut.</p>";
                        if (targetDiv) targetDiv.innerHTML = errorMsg;
                        if (aiMessageContainer) aiMessageContainer.innerHTML = errorMsg;
                        enableChatInput();
                    });
                }
                push();
            })
            .catch(err => {
                console.error('Fetch error:', err);
                const errorMsg = "<p class='text-red-500'>Entschuldigung, ein Netzwerkfehler ist aufgetreten. Bitte überprüfen Sie Ihre Verbindung und versuchen Sie es erneut.</p>";
                if (isInitialAnalysis) {
                    document.getElementById('initial-result').innerHTML = errorMsg;
                }
                 enableChatInput();
            });
        }

        function showChatInterface() {
            document.getElementById('chat-history').innerHTML = `
                <div class="mb-4">
                    <div class="font-bold text-gray-800 mb-1">Vollständiger KI-Bericht</div>
                    <div class="bg-gray-100 p-3 rounded-lg">${converter.makeHtml(fullReport)}</div>
                </div>`;
            document.getElementById('chat-wrapper').classList.remove('hidden');
            document.getElementById('chat-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    document.getElementById('send-btn').click();
                }
            });
            document.getElementById('send-btn').addEventListener('click', handleSendMessage);
            enableChatInput();
        }

        function handleSendMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            if (!message) return;

            disableChatInput();
            
            const chatHistory = document.getElementById('chat-history');
            chatHistory.innerHTML += `
                <div class="mb-4 text-right">
                    <div class="font-bold text-blue-600 mb-1">Sie</div>
                    <div class="bg-blue-100 inline-block p-3 rounded-lg">${message}</div>
                </div>`;
            chatHistory.scrollTop = chatHistory.scrollHeight;

            input.value = '';

            withTurnstileVerification((token) => {
                fetchAnalysis(message, token, false);
            });
        }
        
        function disableChatInput() {
            document.getElementById('chat-input').disabled = true;
            document.getElementById('send-btn').disabled = true;
            document.getElementById('send-btn').innerHTML = '<div class="spinner mx-auto" style="width: 24px; height: 24px; border-width: 3px;"></div>';
        }

        function enableChatInput() {
            document.getElementById('chat-input').disabled = false;
            document.getElementById('send-btn').disabled = false;
            document.getElementById('send-btn').innerHTML = '&rarr;';
        }

    </script>
</body>
</html> 