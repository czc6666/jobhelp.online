<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test starten | Karriere-Kompass</title>
    <meta name="description" content="Beantworten Sie 5 Fragen, um sofort einen KI-generierten, tiefgehenden Analysebericht Ihrer beruflichen Persönlichkeit zu erhalten und Ihre Karriere-Entdeckungsreise zu beginnen.">
    <meta name="keywords" content="Karrieretest, Persönlichkeitsanalyse, KI-Karriereberater, berufliche Richtung, Karriere-Kompass, Online-Quiz">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://jobhelp.online/de/quiz.html">

    <!-- Hreflang for SEO -->
    <link rel="alternate" hreflang="zh" href="https://jobhelp.online/quiz.html">
    <link rel="alternate" hreflang="en" href="https://jobhelp.online/en/quiz.html">
    <link rel="alternate" hreflang="es" href="https://jobhelp.online/es/quiz.html">
    <link rel="alternate" hreflang="de" href="https://jobhelp.online/de/quiz.html">
    <link rel="alternate" hreflang="x-default" href="https://jobhelp.online/quiz.html">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://jobhelp.online/de/quiz.html">
    <meta property="og:title" content="Test starten | Karriere-Kompass">
    <meta property="og:description" content="Beantworten Sie 5 Fragen und erhalten Sie sofort einen KI-generierten, tiefgehenden Analysebericht.">
    <meta property="og:image" content="https://jobhelp.online/og-image.png">
    <meta property="og:site_name" content="Karriere-Kompass">
    <meta property="og:locale" content="de_DE">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://jobhelp.online/de/quiz.html">
    <meta name="twitter:title" content="Test starten | Karriere-Kompass">
    <meta name="twitter:description" content="Beantworten Sie 5 Fragen und erhalten Sie sofort einen KI-generierten, tiefgehenden Analysebericht.">
    <meta name="twitter:image" content="https://jobhelp.online/og-image.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"></script>
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js?onload=onTurnstileLoad" async defer></script>
    <style> .quiz-card, #direct-input-container { min-height: 32rem; } </style>
</head>
<body class="bg-gray-50 flex flex-col min-h-screen">

    <!-- Header -->
    <header class="w-full bg-white/80 backdrop-blur-md sticky top-0 z-10 border-b border-gray-200">
        <div class="container mx-auto px-6 py-4 flex items-center justify-between">
            <a href="/de/" class="text-xl font-bold text-gray-900">Karriere-Kompass</a>
            <a href="/de/" class="text-sm font-semibold text-gray-600 hover:text-blue-600">
                &larr; Zurück zur Startseite
            </a>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow flex flex-col items-center justify-center p-4">
        <div id="view-container" class="w-full max-w-2xl mx-auto">
            <!-- Quiz Container -->
            <div id="quiz-container"></div>
            <!-- Direct Input -->
            <div id="direct-input-container" class="hidden bg-white rounded-xl shadow-lg p-6 md:p-10">
                <h2 class="text-2xl md:text-3xl font-bold text-gray-900 mb-2">Direkt mit dem KI-Mentor sprechen</h2>
                <p class="text-gray-600 mb-6">Geben Sie unten Ihre Bedenken, Gedanken oder eine kurze Vorstellung ein, und die KI erstellt einen persönlichen Karriereplan für Sie.</p>
                <textarea id="direct-input-text" rows="8" placeholder="z.B.: Ich studiere Marketing, fühle mich aber introvertiert und mag keinen Smalltalk. Ich bin unsicher über meine Zukunft..." class="w-full border rounded-lg p-3 text-base focus:ring-2 focus:ring-blue-500 focus:outline-none"></textarea>
                <button id="direct-input-submit-btn" class="w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-full text-base inline-block hover:bg-blue-700 transition mt-6">
                    Analyse von KI anfordern
                </button>
            </div>
        </div>

        <!-- Skip Link -->
        <div id="skip-quiz-container" class="text-center mt-6">
            <button id="skip-quiz-btn" class="text-sm font-semibold text-gray-500 hover:text-blue-600 transition">
                Keine Fragen beantworten? Geben Sie Ihre Gedanken direkt ein &rarr;
            </button>
        </div>

        <!-- Results/Chat -->
        <div id="results-container" class="w-full max-w-3xl mx-auto hidden">
            <div id="initial-result" class="text-center bg-white rounded-xl shadow-lg p-6 md:p-10"></div>
            <div id="chat-wrapper" class="hidden mt-6 bg-white rounded-xl shadow-lg p-6 md:p-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-4">Tiefgehendes Gespräch mit dem KI-Mentor</h2>
                <div id="chat-history" class="h-[50vh] overflow-y-auto pr-4 mb-4 border-b"></div>
                <div id="chat-input-container" class="flex items-center pt-4">
                    <input type="text" id="chat-input" placeholder="Weitere Fragen? Hier eingeben..." class="flex-grow border rounded-l-lg p-3 focus:ring-2 focus:ring-blue-500 focus:outline-none">
                    <button id="send-btn" class="bg-blue-600 text-white font-semibold px-6 py-3 rounded-r-lg hover:bg-blue-700 transition">&rarr;</button>
                </div>
            </div>
        </div>
    </main>

    <div id="turnstile-container"></div>
    <footer class="w-full py-6 text-center bg-white/50 border-t">
        <p class="text-sm text-gray-500">&copy; 2025 Karriere-Kompass. Alle Rechte vorbehalten.</p>
    </footer>

    <script>
        const API_URL = "/api/analyze";
        const LANG = "de";

        let turnstileWidgetId = null;
        let actionQueue = [];
        let isVerificationInProgress = false;

        window.onTurnstileLoad = function () {
            if (typeof turnstile !== 'undefined') {
                turnstileWidgetId = turnstile.render('#turnstile-container', {
                    sitekey: '0x4AAAAAABhyfTjwR6RXipd_',
                    callback: function(token) {
                        isVerificationInProgress = false;
                        const action = actionQueue.shift();
                        if (action) { action(token); }
                    },
                    'expired-callback': function() {
                        isVerificationInProgress = false;
                        if (turnstileWidgetId) { turnstile.reset(turnstileWidgetId); }
                    },
                    'error-callback': function() {
                        isVerificationInProgress = false;
                        document.getElementById('initial-result').innerHTML = `<div class="text-red-500">Sicherheitsüberprüfung fehlgeschlagen. Bitte aktualisieren und erneut versuchen.</div>`;
                        actionQueue = [];
                    },
                    size: 'invisible',
                });
            }
        };

        function executeProtectedAction(action) {
            actionQueue.push(action);
            if (isVerificationInProgress) { return; }
            if (turnstileWidgetId !== null) {
                isVerificationInProgress = true;
                turnstile.execute(turnstileWidgetId);
            } else {
                document.getElementById('initial-result').innerHTML = `<div class="text-red-500">Verifizierungskomponente konnte nicht geladen werden. Bitte laden Sie die Seite neu.</div>`;
            }
        }

        const questions = [
            {
                question: "Stellen Sie sich vor, Sie sind auf einer lockeren Party. Welche Aktivität würde Sie am meisten ansprechen?",
                options: [
                    "Ein tiefes, persönliches Gespräch mit einem engen Freund führen.",
                    "Leute beobachten und die sozialen Dynamiken analysieren.",
                    "An einem lebhaften Brettspiel oder einer Gruppenaktivität teilnehmen.",
                    "Dem Gastgeber beim Organisieren von Essen helfen oder sicherstellen, dass alle eine gute Zeit haben."
                ]
            },
            {
                question: "Wenn Sie ein komplett freies Wochenende hätten, wie würden Sie es idealerweise verbringen?",
                options: [
                    "Ein Buch lesen, eine neue Fähigkeit erlernen oder eine Dokumentation ansehen.",
                    "Etwas Kreatives schaffen: schreiben, zeichnen, Musik machen oder ein DIY-Projekt.",
                    "Wandern gehen, Sport treiben oder eine andere körperliche Aktivität im Freien.",
                    "Qualitätszeit mit Familie oder Freunden verbringen."
                ]
            },
            {
                question: "Wenn Sie bei der Arbeit vor einem komplexen Problem stehen, was ist Ihr erster Ansatz?",
                options: [
                    "Daten sammeln und analysieren, um die Ursache zu verstehen.",
                    "Kreative und unkonventionelle Lösungen brainstormen.",
                    "Ein Team organisieren und Aufgaben delegieren, um es von mehreren Seiten anzugehen.",
                    "Die Auswirkungen des Problems auf Teammitglieder und Kunden berücksichtigen."
                ]
            },
            {
                question: "Was motiviert Sie in einer Karriere am meisten?",
                options: [
                    "Die Beherrschung einer Fähigkeit und zum Experten auf Ihrem Gebiet zu werden.",
                    "Die Möglichkeit, Kreativität auszudrücken und innovativ zu sein.",
                    "Führung, Einfluss und das Erreichen ehrgeiziger Ziele.",
                    "Anderen zu helfen und einen positiven Einfluss auf die Gesellschaft zu haben."
                ]
            },
            {
                question: "Welche Art von Arbeitsumgebung bevorzugen Sie?",
                options: [
                    "Eine ruhige, strukturierte Umgebung, in der Sie sich auf Ihre Aufgaben konzentrieren können.",
                    "Eine dynamische, flexible Umgebung, die zum Experimentieren anregt.",
                    "Eine wettbewerbsorientierte, ergebnisorientierte Umgebung mit klaren Zielen.",
                    "Eine kollaborative, unterstützende Umgebung, die auf Teamarbeit ausgerichtet ist."
                ]
            }
        ];

        let currentQuestionIndex = 0;
        const userAnswers = [];
        const markdownConverter = new showdown.Converter({ simplifiedAutoLink: true, tables: true, strikethrough: true });

        const viewContainer = document.getElementById('view-container');
        const quizContainer = document.getElementById('quiz-container');
        const skipQuizContainer = document.getElementById('skip-quiz-container');
        const directInputContainer = document.getElementById('direct-input-container');
        const resultsContainer = document.getElementById('results-container');
        const additionalContent = document.getElementById('additional-content');
        const initialResultContainer = document.getElementById('initial-result');
        const chatWrapper = document.getElementById('chat-wrapper');
        const chatHistory = document.getElementById('chat-history');
        const chatInput = document.getElementById('chat-input');
        const sendBtn = document.getElementById('send-btn');
        
        function renderQuestion() {
            const cardData = questions[currentQuestionIndex];
            const card = document.createElement('div');
            card.className = 'quiz-card bg-white rounded-xl shadow-lg p-6 md:p-10 card-enter';
            
            const optionsHTML = cardData.options.map(option => `
                <div class="option border rounded-lg p-4 mb-3 cursor-pointer hover:bg-blue-50 hover:border-blue-500 transition">
                    <span>${option}</span>
                </div>`
            ).join('');

            card.innerHTML = `
                <div class="text-right text-sm font-semibold text-gray-400 mb-4">${currentQuestionIndex + 1} / ${questions.length}</div>
                <h2 class="text-2xl md:text-3xl font-bold text-gray-900 mb-8">${cardData.question}</h2>
                <div class="options-container">${optionsHTML}</div>
            `;
            
            quizContainer.innerHTML = '';
            quizContainer.appendChild(card);
            requestAnimationFrame(() => card.classList.remove('card-enter'));
            card.querySelectorAll('.option').forEach(el => el.addEventListener('click', () => handleOptionSelect(el.querySelector('span').innerText)));
        }

        function handleOptionSelect(answer) {
            userAnswers.push({ question: questions[currentQuestionIndex].question, answer: answer });
            const card = quizContainer.querySelector('.quiz-card');
            card.classList.add('card-exit');
            
            setTimeout(() => {
                currentQuestionIndex++;
                if (currentQuestionIndex < questions.length) {
                    renderQuestion();
                } else {
                    const prompt = createQuizPrompt(JSON.stringify(userAnswers));
                    triggerAnalysis(prompt);
                }
            }, 500);
        }

        function triggerAnalysis(prompt) {
            viewContainer.style.display = 'none';
            skipQuizContainer.style.display = 'none';
            additionalContent.style.display = 'none';
            resultsContainer.style.display = 'block';
            initialResultContainer.innerHTML = `<div class="flex flex-col items-center justify-center h-full text-center"><div class="spinner"></div><p class="text-gray-600 mt-4">Verifizierung wird angefordert...</p></div>`;
            
            executeProtectedAction((token) => {
                initialResultContainer.innerHTML = `<div class="flex flex-col items-center justify-center h-full text-center"><div class="spinner"></div><p class="text-gray-600 mt-4">Verifizierung erfolgreich. Ihre Erstanalyse wird erstellt...</p></div>`;
                callInitialAnalysis(prompt, token);
            });
        }

        function createQuizPrompt(userChoices) {
            return `Sie sind ein erstklassiger KI-Karriereberater namens "Karriere-Kompass". Der Benutzer hat den Fragebogen ausgefüllt. Hier sind seine Antworten:
            ---
            ${userChoices}
            ---
            Bitte geben Sie Ihre Analyse streng im folgenden JSON-Format zurück.
            Wichtige Regel: Ihre gesamte Antwort muss ein einziges, rohes JSON-Objekt sein, das direkt von JSON.parse() verarbeitet werden kann. Innerhalb von JSON-Zeichenkettenwerten müssen alle doppelten Anführungszeichen (") mit einem Backslash (\\) maskiert werden, z.B. "Er sagte \\"Hallo Welt\\"".
            {
              "archetype_title": "Ein prägnanter, ansprechender Archetyp-Titel, z.B. Der Risikokontrolleur",
              "archetype_summary": "Eine Ein-Satz-Zusammenfassung, die die Kernmerkmale dieses Archetyps anschaulich erfasst.",
              "job_suggestions": ["Nennen Sie die 3 am besten passenden Karrierewege basierend auf der Analyse (Array von Strings)"],
              "full_report": "Dies ist der vollständige, detaillierte Analysebericht, bitte verwenden Sie das Markdown-Format. Der Bericht sollte enthalten: 1. Eine tiefere Interpretation des Archetyps. 2. Eine detaillierte Analyse seiner Werte und Motivationen. 3. Eine detaillierte Erläuterung der 3 empfohlenen Karrierewege. 4. Einen ermutigenden Abschluss und eine Aufforderung zu Folgefragen."
            }`;
        }

        function createDirectInputPrompt(userInput) {
            return `Sie sind ein erstklassiger KI-Karriereberater namens "Karriere-Kompass". Ein Benutzer hat ein direktes Gespräch initiiert. Hier ist seine Eingabe:
            ---
            ${userInput}
            ---
            Bitte geben Sie Ihre Analyse streng im folgenden JSON-Format zurück.
            Wichtige Regel: Ihre gesamte Antwort muss ein einziges, rohes JSON-Objekt sein, das direkt von JSON.parse() verarbeitet werden kann. Innerhalb von JSON-Zeichenkettenwerten müssen alle doppelten Anführungszeichen (") mit einem Backslash (\\) maskiert werden, z.B. "Er sagte \\"Hallo Welt\\"".
            {
              "archetype_title": "Ein prägnanter, ansprechender Archetyp-Titel",
              "archetype_summary": "Eine Ein-Satz-Zusammenfassung, die die Kernmerkmale des Benutzers anschaulich erfasst.",
              "job_suggestions": ["Nennen Sie die 3 am besten passenden Karrierewege basierend auf der Analyse (Array von Strings)"],
              "full_report": "Dies ist der vollständige, detaillierte Analysebericht, bitte verwenden Sie das Markdown-Format. Der Bericht sollte enthalten: 1. Eine tiefe Interpretation der Selbstbeschreibung des Benutzers. 2. Aufdeckung potenzieller Werte und Motivationen. 3. Eine detaillierte Erläuterung der 3 empfohlenen Karrierewege. 4. Einen ermutigenden Abschluss und eine Aufforderung zu Folgefragen."
            }`;
        }

        let fullReport = '';
        let conversationHistory = [];

        async function callInitialAnalysis(prompt, turnstileToken) {
             try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: "qwen/qwen3-8b:free",
                        messages: [{ role: "user", content: prompt }],
                        stream: false,
                        turnstileToken: turnstileToken
                    }),
                });

                if (!response.ok) {
                    const errorBody = await response.text();
                    throw new Error(`API-Aufruf fehlgeschlagen: ${response.status}. ${errorBody}`);
                }

                const result = await response.json();
                const analysis = JSON.parse(result.choices[0].message.content);

                fullReport = analysis.full_report.replace(/\\"/g, '"');
                let suggestionsHTML = '';
                if (analysis.job_suggestions && analysis.job_suggestions.length > 0) {
                    suggestionsHTML = `
                        <div class="mt-8 pt-6 border-t border-gray-200">
                            <p class="text-sm font-semibold text-gray-500 mb-4">Empfohlene Karrierewege für Sie:</p>
                            <div class="flex flex-wrap justify-center gap-3">
                                ${analysis.job_suggestions.map(job => `<span class="bg-gray-100 text-gray-800 text-sm font-medium px-4 py-2 rounded-full">${job.replace(/\\"/g, '"')}</span>`).join('')}
                            </div>
                        </div>`;
                }

                initialResultContainer.innerHTML = `
                    <h2 class="text-3xl md:text-4xl font-extrabold text-blue-600 mb-3">${analysis.archetype_title.replace(/\\"/g, '"')}</h2>
                    <p class="text-lg text-gray-700 max-w-2xl mx-auto">${analysis.archetype_summary.replace(/\\"/g, '"')}</p>
                    ${suggestionsHTML}
                    <button id="show-full-report-btn" class="bg-blue-600 text-white font-bold py-3 px-6 rounded-full text-base inline-block hover:bg-blue-700 transition mt-10">
                        Vollständige Analyse ansehen & Chat starten
                    </button>
                `;

                document.getElementById('show-full-report-btn').addEventListener('click', showFullReportAndChat);

            } catch (error) {
                initialResultContainer.innerHTML = `<div class="text-red-500">Entschuldigung, bei der Analyse ist ein Fehler aufgetreten: ${error.message}</div>`;
            }
        }
        
        function showFullReportAndChat() {
            document.getElementById('initial-result').style.display = 'none';
            chatWrapper.style.display = 'block';
            const reportHtml = markdownConverter.makeHtml(fullReport);
            chatHistory.innerHTML = `<div class="prose max-w-none p-2">${reportHtml}</div>`;
            conversationHistory = [
                { role: "user", content: "Dies ist mein Umfrageergebnis, bitte beginnen Sie die Analyse:" + JSON.stringify(userAnswers) },
                { role: "assistant", content: fullReport }
            ];
        }

        async function callLLM(messages, turnstileToken) {
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: "qwen/qwen3-8b:free",
                        messages: messages,
                        stream: true,
                        turnstileToken: turnstileToken
                    }),
                });

                if (!response.ok) throw new Error(`API-Aufruf fehlgeschlagen: ${response.status}. ${await response.text()}`);
                
                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                let buffer = '';
                let botMessageContent = '';
                
                const botMessageContainer = document.createElement('div');
                botMessageContainer.className = "flex justify-start mb-3";
                botMessageContainer.innerHTML = `<div class="bg-gray-100 rounded-lg py-2 px-4 max-w-lg prose"></div>`;
                chatHistory.appendChild(botMessageContainer);
                const contentElement = botMessageContainer.querySelector('div');

                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    buffer += decoder.decode(value, { stream: true });
                    const lines = buffer.split('\n');
                    buffer = lines.pop(); 
                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            const content = line.substring(6);
                            if (content === '[DONE]') continue;
                            try {
                                const chunk = JSON.parse(content);
                                if (chunk.choices[0].delta.content) {
                                    botMessageContent += chunk.choices[0].delta.content;
                                    contentElement.innerHTML = markdownConverter.makeHtml(botMessageContent);
                                    chatHistory.scrollTop = chatHistory.scrollHeight;
                                }
                            } catch (e) { console.error('Fehler beim Parsen des Stream-Chunks:', e); }
                        }
                    }
                }
                conversationHistory.push({ role: "assistant", content: botMessageContent });
            } catch (error) {
                const errorElement = document.createElement('div');
                errorElement.className = 'text-red-500';
                errorElement.textContent = `Entschuldigung, ein Fehler ist aufgetreten: ${error.message}`;
                chatHistory.appendChild(errorElement);
            } finally {
                chatInput.disabled = false;
                sendBtn.disabled = false;
                chatInput.focus();
                if (turnstileWidgetId) turnstile.reset(turnstileWidgetId);
            }
        }
        
        async function handleSendMessage() {
            const messageText = chatInput.value.trim();
            if (!messageText) return;

            const userMessageHTML = `<div class="flex justify-end mb-3"><div class="bg-blue-500 text-white rounded-lg py-2 px-4 max-w-lg">${messageText}</div></div>`;
            chatHistory.innerHTML += userMessageHTML;
            chatHistory.scrollTop = chatHistory.scrollHeight;
            chatInput.value = '';
            chatInput.disabled = true;
            sendBtn.disabled = true;

            const systemInstruction = `Regel: Sie sind ein KI-Karrierementor namens "Karriere-Kompass". Ihre Antworten müssen kurz sein (versuchen Sie, unter drei Sätzen zu bleiben, verwenden Sie oft Listen) und sich immer um Karriereplanung, Kompetenzerwerb, Ratschläge zur Jobsuche usw. drehen. Wenn der Benutzer eine nicht verwandte Frage stellt (z. B. "Wie ist das Wetter?", "Erzählen Sie einen Witz"), müssen Sie höflich ablehnen und ihn zu Karrierethemen zurückführen.`;
            const messagesForAPI = [...conversationHistory, { role: 'system', content: systemInstruction }, { role: 'user', content: messageText }];
            
            executeProtectedAction((token) => {
                conversationHistory.push({ role: 'user', content: messageText });
                callLLM(messagesForAPI, token);
            });
        }

        function setupEventListeners() {
            document.getElementById('skip-quiz-btn').addEventListener('click', () => {
                const card = quizContainer.querySelector('.quiz-card');
                if (card) card.classList.add('card-exit');
                setTimeout(() => {
                    quizContainer.style.display = 'none';
                    directInputContainer.classList.remove('hidden');
                    directInputContainer.classList.add('card-enter');
                    requestAnimationFrame(() => directInputContainer.classList.remove('card-enter'));
                }, 500);
            });

            document.getElementById('direct-input-submit-btn').addEventListener('click', () => {
                const userInput = document.getElementById('direct-input-text').value;
                if (userInput.trim().length < 20) {
                    alert('Für eine genauere Analyse geben Sie bitte mindestens 20 Zeichen ein.');
                    return;
                }
                const prompt = createDirectInputPrompt(userInput);
                triggerAnalysis(prompt);
            });

            sendBtn.addEventListener('click', handleSendMessage);
            chatInput.addEventListener('keypress', (e) => e.key === 'Enter' && !e.shiftKey && (e.preventDefault(), handleSendMessage()));
        }

        document.addEventListener('DOMContentLoaded', () => {
            renderQuestion();
            setupEventListeners();
        });
        
    </script>
</body>
</html> 